<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="WWW::AdventCalendar v1.113" />
    <link rel="alternate" title="Perl Advent Calendar 2018 XML feed" href="atom.xml" type="application/atom+xml" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="2018.css" type="text/css" />
    <title>
Perl Advent Calendar 2018 - 
The future is now

</title>
</head>
<body>
    <div id="contentwrapper">
        <div id="header">
            <h1><a href="index.html">Perl Advent Calendar 2018</a></h1>
        </div>

        <p id="tagline">2018 twenty four merry days of Perl
         <a class='feed' href="atom.xml">Feed</a>
        </p>

        <div id="content">
          

<h1 class='title'>The future is now</h1>
<div class='subtitle'>Future-based interfaces - 2018-12-14</div>

<div class='pod'><p>Today was a big day for Gnomo Knullpointer. They had recently started a new position as a coding elf at Santa&#39;s workshop, and they were eager to fulfil their calling as Santa&#39;s helper, and to start actually <i>helping Santa</i>. And having finally passed their probation, today they were getting their first <i>real</i> assignment. This was all <i>very exciting</i>.</p>

<p>&quot;So you see, Gnomo... is that how you pronounce your name?&quot; asked Santa, without really expecting a reply. &quot;We need to modernise the way we send our gifts, and I want you to write a ... package, is it? One of those things to do it. Think you&#39;re up to the task?&quot;.</p>

<p>Gnomo was very much up to the task.</p>

<p>Always eager to please, Gnomo set out to write what was needed. The first version looked a bit like this:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">Santa::Helper</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">HTTP::Tiny</span><span class="structure">;</span><br /><br /><span class="keyword">my</span> <span class="symbol">$ua</span> <span class="operator">=</span> <span class="word">HTTP::Tiny</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">;</span><br /><br /><span class="keyword">sub</span> <span class="word">send_gifts</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span> <span class="structure">(</span><span class="magic">@_</span><span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="structure">(</span> <span class="symbol">$address</span><span class="operator">,</span> <span class="symbol">$gift</span> <span class="structure">)</span> <span class="operator">=</span> <span class="structure">(</span> <span class="core">shift</span><span class="operator">,</span> <span class="core">shift</span> <span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$res</span> <span class="operator">=</span> <span class="symbol">$ua</span><span class="operator">-&gt;</span><span class="word">post</span><span class="structure">(</span> <span class="symbol">$address</span><span class="operator">,</span> <span class="symbol">$gift</span> <span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> <span class="structure">(</span><span class="symbol">$res</span><span class="operator">-&gt;</span><span class="structure">{</span><span class="word">success</span><span class="structure">})</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">print</span> <span class="double">&quot;Gift was delivered to $address!\n&quot;</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">print</span> <span class="double">&quot;Could not deliver gift to $address :(\n&quot;</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br /><span class="structure">}</span></code><br />&nbsp;</td></table>

<p>Which would then be called without much flourish like so:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="word">Santa::Helper::send_gifts</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/delay/5'</span>    <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'teddy_bear'</span>  <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/status/500'</span> <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'raspberrypi'</span> <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/delay/1'</span>    <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'puppy'</span>       <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/delay/2'</span>    <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'bycicle'</span>     <span class="structure">}</span><span class="operator">,</span><br /><span class="structure">)</span></code><br />&nbsp;</td></table>

<p>&quot;I like it!&quot; said Santa, impressed by the colours of the syntax highlighter. &quot;What do you think, Ada?&quot;, he said, looking at Ada Slashd&oacute;ttir the senior developer in the team.</p>

<p>&quot;Well, yeah, it&#39;s all well and good. It certainly gets the job done. But it&#39;s not very <i>efficient</i>&quot;, said Ada. &quot;This delivers the gifts one after the other. We have a lot of helpers. Why not send all the gifts out at the same time, and then let them take as long as they must? When the gifts are all delivered, then we can send the sleigh back to fetch more.&quot;</p>

<p>&quot;Oh, you mean send the gifts <i>asynchronously</i>&quot;, replied Gnomo.</p>

<p>Santa, was starting to lose focus. He had never been into the implementation details, and preferred to surround himself with people he could trust, like Ada. He let the developer elves flex their intellectual muscles, confident they could sort it out.</p>

<p>After a little more coding, Gnomo came back with this:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">Santa::Helper</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">IO::Async::Loop</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">Net::Async::HTTP</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">URI</span><span class="structure">;</span><br /><br /><span class="keyword">my</span> <span class="symbol">$ua</span> <span class="operator">=</span> <span class="word">Net::Async::HTTP</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">max_connections_per_host</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">fail_on_error</span>            <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">IO::Async::Loop</span><span class="operator">-&gt;</span><span class="word">new</span><span class="operator">-&gt;</span><span class="word">add</span><span class="structure">(</span> <span class="symbol">$ua</span> <span class="structure">);</span><br /><br /><span class="keyword">sub</span> <span class="word">send_gifts</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">@requests</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span> <span class="structure">(</span><span class="magic">@_</span><span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="structure">(</span> <span class="symbol">$address</span><span class="operator">,</span> <span class="symbol">$gift</span> <span class="structure">)</span> <span class="operator">=</span> <span class="structure">(</span> <span class="core">shift</span><span class="operator">,</span> <span class="core">shift</span> <span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">push</span> <span class="symbol">@requests</span><span class="operator">,</span> <span class="symbol">$ua</span><span class="operator">-&gt;</span><span class="word">POST</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">URI</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span> <span class="symbol">$address</span> <span class="structure">)</span> <span class="operator">=&gt;</span> <span class="symbol">$gift</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">on_response</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">print</span> <span class="double">&quot;Gift was delivered to $address!\n&quot;</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">on_error</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">print</span> <span class="double">&quot;Could not deliver gift to $address :(\n&quot;</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">@requests</span><span class="structure">;</span><br /><span class="structure">}</span></code><br />&nbsp;</td></table>

<p>Ada was pleased. &quot;That&#39;s more like it!&quot;</p>

<p>&quot;But hold on a second&quot;, said Duende Juniorsson, the junior developer. &quot;If I call this like we did with the previous one, <i>nothing happens</i>.&quot;</p>

<p>Santa looked worried.</p>

<p>&quot;Oh, it only <i>looks</i> like nothing happens because the function now returns immediately with a Future, and you are not waiting for it to actually get any work done&quot;, explained Gnomo.</p>

<p>&quot;Exactly&quot;, said Ada. &quot;A Future represents the result of an action that, like its name implies, will be completed in the future. So you need to wait for it to complete before you can get a result.&quot;</p>

<p>Santa looked worried <i>and</i> confused.</p>

<p>&quot;So how <i>should</i> we call it, then?&quot;, asked Duende.</p>

<p>Gnomo replied: &quot;You can wait on an individual Future, like this&quot;:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="word">Santa::Helper::send_gifts</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/delay/5'</span> <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'teddy_bear'</span>  <span class="structure">}</span><span class="operator">,</span><br /><span class="structure">)</span><span class="operator">-&gt;</span><span class="word">get</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>&quot;Or use a convergent Future, to wait for a set of them at once&quot;, suggested Ada:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="word">Future</span><span class="operator">-&gt;</span><span class="word">wait_all</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Santa::Helper::send_gifts</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/delay/5'</span>    <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'teddy_bear'</span>  <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/status/500'</span> <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'raspberrypi'</span> <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/delay/1'</span>    <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'puppy'</span>       <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'http://httpbin.org/delay/2'</span>    <span class="operator">=&gt;</span> <span class="structure">{</span> <span class="word">code</span> <span class="operator">=&gt;</span> <span class="single">'bycicle'</span>     <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><br /><span class="structure">)</span><span class="operator">-&gt;</span><span class="word">get</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>Santa started sweating profusely. Convergent <i>what</i>? &quot;I, um... just want it to send a gift... I didn&#39;t think we were going to start messing with the timeline, at least not just yet...&quot;. The developer elves looked at each other.</p>

<p>&quot;I mean, I like what Ada wanted, to make all the gifts be delivered asymptotically...&quot;, said Santa.</p>

<p>&quot;Asynchronously&quot;, corrected Ada.</p>

<p>&quot;Right&quot;, said Santa. &quot;Asynchronously, that&#39;s what I said. I liked that bit. But I think things got a little confusing.&quot;</p>

<p>Duende agreed. &quot;Yeah, I mean, I&#39;m only getting started, but even I could clearly understand what <code>send_gift(...)</code> meant. But I&#39;ve been staring at <code>send_gift(...)-&gt;get</code> for a bit, and I still have no idea what it does. And don&#39;t even get me started on having ... futures that wait on other futures?&quot;.</p>

<p>&quot;Yes, this is true&quot;, said Ada. &quot;The interface has got a bit more complicated, and not every user of this helper will want to deal directly with the Futures, or even know or care what they are.&quot;</p>

<p>&quot;How about,&quot; suggested Gnomo, &quot;we leave the non-blocking implementation in the background, exposed through a function for those who need it, but make another function that can be used as a blocking interface for those who just want to send the gifts already?&quot; This is what they had in mind:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">Santa::Helper</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">IO::Async::Loop</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">Net::Async::HTTP</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">URI</span><span class="structure">;</span><br /><br /><span class="keyword">my</span> <span class="symbol">$ua</span> <span class="operator">=</span> <span class="word">Net::Async::HTTP</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">max_connections_per_host</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">fail_on_error</span>            <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">IO::Async::Loop</span><span class="operator">-&gt;</span><span class="word">new</span><span class="operator">-&gt;</span><span class="word">add</span><span class="structure">(</span> <span class="symbol">$ua</span> <span class="structure">);</span><br /><br /><span class="comment"># Non-blocking, returns Futures<br /></span><span class="keyword">sub</span> <span class="word">send_gifts_f</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">@requests</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span> <span class="structure">(</span><span class="magic">@_</span><span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="structure">(</span> <span class="symbol">$address</span><span class="operator">,</span> <span class="symbol">$gift</span> <span class="structure">)</span> <span class="operator">=</span> <span class="structure">(</span> <span class="core">shift</span><span class="operator">,</span> <span class="core">shift</span> <span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">push</span> <span class="symbol">@requests</span><span class="operator">,</span> <span class="symbol">$ua</span><span class="operator">-&gt;</span><span class="word">POST</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">URI</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span> <span class="symbol">$address</span> <span class="structure">)</span> <span class="operator">=&gt;</span> <span class="symbol">$gift</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">on_response</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">print</span> <span class="double">&quot;Gift was delivered to $address!\n&quot;</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">on_error</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">print</span> <span class="double">&quot;Could not deliver gift to $address :(\n&quot;</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">@requests</span><span class="structure">;</span><br /><span class="structure">}</span><br /><br /><span class="comment"># Blocking, waits for all the Futures before returning<br /></span><span class="keyword">sub</span> <span class="word">send_gifts</span> <span class="structure">{</span> <span class="word">Future</span><span class="operator">-&gt;</span><span class="word">wait_all</span><span class="structure">(</span> <span class="word">send_gifts_f</span><span class="structure">(</span> <span class="magic">@_</span> <span class="structure">)</span> <span class="structure">)</span><span class="operator">-&gt;</span><span class="word">get</span> <span class="structure">}</span></code><br />&nbsp;</td></table>

<p>&quot;So now if you want or care about the Futures,&quot; explained Gnomo, &quot;you can call the functions that end with <code>_f</code>, and know what those will return immediately with a Future. But you can also use the helper as a vanilla non-blocking library if you want&quot;.</p>

<p>&quot;Incidentally,&quot; commented Ada, &quot;there&#39;s already a bunch of libraries on CPAN that do exactly this. Some of them use <code>_p</code> as the suffix, and others use entirely different names when they make sense. What matters is that Futures allow for this sort of versatility, so even non-blocking libraries, or those based on them, can also provide blocking interfaces.&quot;</p>

<p>Santa nodded, wondering if he was expected to say something. It looked like he was safe, though, since everyone was smiling. He decided to leave the details in their hands and go back to more pressing matters.</p>

<p>After all, those milk and cookies weren&#39;t going to eat themselves!</p>

</div>

<div id='author'>
<img alt='Gravatar Image' style='vertical-align:middle' src=http://www.gravatar.com/avatar/c796997d2231a41e24f485e4726ea810?r=g&s=80&d=retro />
This article contributed by: Jos&eacute; Joaqu&iacute;n Atria &lt;jjatria@cpan.org&gt;
</div>


<ul id="pager">
    <li class="previous"><a title="Lost in legacy arguments" href="2018-12-13.html">Previous</a></li>

    <li class="next"><a title="Spot The Difference" href="2018-12-15.html">Next</a></li>
</ul>
<div style="clear: both"></div>

        </div>

    </div>



<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-27056407-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>





